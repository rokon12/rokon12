<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="canonical" href="https://bazlur.ca/2022/08/31/java-thread-programming-part-15/"><title>Java Thread Programming (Part 15) | Bazlur’s Blog Archive</title><meta name="generator" content="Jekyll v3.9.5" /><meta property="og:title" content="Java Thread Programming (Part 15)" /><meta name="author" content="A N M Bazlur Rahman" /><meta property="og:locale" content="en_US" /><meta name="description" content="A comprehensive archive of articles on Java, Software Development, and Technology" /><meta property="og:description" content="A comprehensive archive of articles on Java, Software Development, and Technology" /><link rel="canonical" href="http://localhost:4001/backup/java-thread-programming-part-15.html" /><meta property="og:url" content="http://localhost:4001/backup/java-thread-programming-part-15.html" /><meta property="og:site_name" content="Bazlur’s Blog Archive" /><meta property="og:image" content="http://localhost:4001/assets/img/default-og.jpg" /><meta property="og:type" content="website" /><meta name="twitter:card" content="summary" /><meta property="twitter:image" content="http://localhost:4001/assets/img/default-og.jpg" /><meta property="twitter:title" content="Java Thread Programming (Part 15)" /><meta name="twitter:site" content="@bazlur_rahman" /><meta name="twitter:creator" content="@A N M Bazlur Rahman" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"A N M Bazlur Rahman","url":"https://bazlur.ca"},"description":"A comprehensive archive of articles on Java, Software Development, and Technology","headline":"Java Thread Programming (Part 15)","image":"http://localhost:4001/assets/img/default-og.jpg","url":"http://localhost:4001/backup/java-thread-programming-part-15.html"}</script><style> /* Critical CSS - Inline for faster initial render */ :root { --primary-color: #2563eb; --secondary-color: #7c3aed; --text-color: #1f2937; --text-light: #6b7280; --bg-color: #ffffff; --bg-gray: #f9fafb; } * { margin: 0; padding: 0; box-sizing: border-box; } body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; line-height: 1.6; color: var(--text-color); background: var(--bg-gray); } .wrapper { max-width: 1200px; margin: 0 auto; padding: 0 2rem; } header { background: var(--bg-color); box-shadow: 0 1px 3px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 100; } .site-nav { display: flex; justify-content: space-between; align-items: center; padding: 1rem 0; } .site-title { font-size: 1.5rem; font-weight: 700; color: var(--primary-color); text-decoration: none; } .nav-links { display: flex; gap: 2rem; list-style: none; } .nav-links a { color: var(--text-color); text-decoration: none; transition: color 0.2s; } .nav-links a:hover { color: var(--primary-color); } /* Above-the-fold home page styles */ .banner-container { margin: 2rem auto 3rem; text-align: center; } .ascii-banner { display: inline-block; font-family: 'JetBrains Mono', monospace; font-size: 11px; line-height: 1.2; color: var(--primary-color); } @media (max-width: 768px) { .wrapper { padding: 0 1rem; } .ascii-banner { font-size: 6px; } .nav-links { gap: 1rem; } }</style><link rel="preload" href="/assets/css/main.css?v=2" as="style" onload="this.onload=null;this.rel='stylesheet'"> <noscript><link rel="stylesheet" href="/assets/css/main.css?v=2"></noscript><link rel="alternate" type="application/rss+xml" title="Bazlur&#39;s Blog Archive" href="/feed.xml"><link rel="dns-prefetch" href="https://fonts.googleapis.com"><link rel="dns-prefetch" href="https://cdnjs.cloudflare.com"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet"><body><header class="site-header"><div class="header-wrapper"> <a class="site-title" href="/">Bazlur&#39;s Blog Archive</a> <button class="mobile-menu-toggle" aria-label="Toggle menu" aria-expanded="false"> <span class="hamburger"> <span></span> <span></span> <span></span> </span> </button><nav class="site-nav"> <a class="nav-link" href="/">Home</a> <a class="nav-link" href="/archive">Archive</a> <a class="nav-link" href="/tags">Tags</a> <a class="nav-link" href="/search">Search</a> <a class="nav-link" href="https://bazlur.com/conference/" target="_blank" rel="noopener">Speaking</a> <a class="nav-link" href="/about">About</a> <a class="nav-link nav-link-external" href="https://bazlur.ca" target="_blank" rel="noopener">Original Site →</a></nav></div></header><main class="page-content" aria-label="Content"><p><img src="/backup/images/bozhin-karaivanov-k6cc1d-k-g-unsplash-scaled.jpg" alt="" /></p><h1 id="java-thread-programming-part-15">Java Thread Programming (Part 15)</h1><p>This article will discuss how we do asynchronous method invocation with <a href="https://docs.oracle.com/en/java/javase/18/docs/api/java.base/java/util/concurrent/Callable.html">Callable</a> and <a href="https://docs.oracle.com/en/java/javase/18/docs/api/java.base/java/util/concurrent/Future.html">Future</a> with a practical example.</p><p><img src="/backup/images/playground.java-700x227.png" alt="" /></p><p>Look at the code snippet. It doesn’t have anything yet, but <a href="/2022/03/01/java-thread-programming-part-14/">as we learned about Java threading</a>, we know anything we put here will run on the main thread unless we spawn a new thread from here.</p><p>Now consider a case where you work as a banker, and you need to calculate how much credit you can provide to a person.</p><p>To calculate the credit, you need to calculate that person’s assets and liabilities. And then, you want to do some other tasks and pass the assets and liabilities to the credit score calculator. So let’s put these thoughts into code:</p><pre><code>private static Credit calculateCreditForPerson(Long personId) {
     var person = getPerson(personId);
     var assets = getAssets(person);
     var liabilities = getLiabilities(person);

     doSomeImportantTask();
     return calculateCredit(assets, liabilities);
 }
</code></pre><p>This is pretty sequential, and all of them are done one after one. Each method takes some time to work on. It calls the database and then waits for the result. Until the result is returned, the execution waits. This is a blocking scenario.</p><p>That means when it calls the <code>getPerson()</code> method, if it makes a network call, which is usually an IO-bound task until we get the result, the main thread would just block, and nothing would progress here. Once the result is returned, we get to the next method, which is another blocking method, as it also makes a database call over the network.</p><p>We have five methods over here. If all of them take around 200 milliseconds each to execute, that’s 1000 milliseconds. While executing all the methods, the main thread is blocked most of the time without doing anything. We shouldn’t really waste a resource like this. How about we optimize it so that it doesn’t take the whole 1000 milliseconds?</p><p>The solution is to pass those method executions into different threads. Of course, we can create a new thread for each method directly through the new operator, but we need to get the result from the thread.</p><pre><code>AtomicReference person = new AtomicReference&lt;&gt;();
new Thread(() -&gt; {
    var p = getPerson(personId);
    person.set(p);
}).start();
</code></pre><p>We could do something like the above. We are essentially sharing the state between the main and newly created threads. In such a case, we use <a href="https://docs.oracle.com/en/java/javase/18/docs/api/java.base/java/util/concurrent/atomic/AtomicReference.html">AtomicReference</a> to update variables in a thread-safe way.</p><p>But over here, we are spawning a new thread. So each time we execute the code, we have to create multiple threads. Creating threads is an expensive operation. We should not create them on an ad-hoc basis. We should use ThreadPool instead, which we will do later. Let’s see the whole code.</p><pre><code>private static Credit calculateCreditForPerson(Long personId) throws InterruptedException {
    var person = getPerson(personId);
    var assetRef = new AtomicReference();
    var t1 = new Thread(() -&gt; assetRef.set(getAssets(person)));

    var liabilitiesRef = new AtomicReference();
    var t2 = new Thread(() -&gt; liabilitiesRef.set(getLiabilities(person)));
    var t3 = new Thread(() -&gt; doSomeImportantTask());
    t3.start();

    t1.join();
    t2.join();

    var credit = calculateCredit(assetRef.get(), liabilitiesRef.get());

    t3.join();

    return credit;
}
</code></pre><p>Over there, the first method call is indeed a blocking call. The main thread waits for the method to finish the work. The following two methods’ invocation depends on this, so even if we execute it through another thread, we need to wait for its results.</p><p>So executing it from the main thread makes sense. The next three methods can be executed independently. They should not wait for each other. So we can pass them into three separate threads, which we did over here.</p><p>The final method of invocation is dependent on the second and third methods. So we need to wait on them. That’s why we called the join method on the threads of those two methods.</p><p>And finally, before returning the credit, we join the third thread.</p><p>The code above works and takes less time, but it is very hard to understand and has too many moving parts.</p><p>Let’s not create a thread for each method by ourselves; rather, we should use executors. That’s best practice. Let’s do that.</p><pre><code>private static Credit calculateCreditForPerson3(ExecutorService pool)
        throws ExecutionException, InterruptedException {
    var person = getPerson(1L);
    Future&lt;Assets&gt; assetFuture = pool.submit(() -&gt; getAssets(person));
    Future&lt;Liabilities&gt; liabilitiesFuture = pool.submit(() -&gt; getLiabilities(person));

    pool.submit(() -&gt; doSomeImportantTask());

    return calculateCredit(assetFuture.get(), liabilitiesFuture.get());
}
</code></pre><p>To know how the future works, read part 12 of this threading series: ​​<a href="https://foojay.io/today/java-thread-programming-part-12/">https://foojay.io/today/java-thread-programming-part-12/</a>.</p><p><img src="/backup/images/aysnchronos-programming-1024x447.png" alt="" /></p><p>The code exactly does the same thing, but it is much cleaner and better. The basic idea is that the second and third methods are being executed independently and separately in other threads.</p><p>While they are being executed, the main thread is not blocked, and we made some progress in invoking the fourth method. Indeed, when we called <code>future.get()</code> blocking call the final method, but that is necessary. It could happen that they are already finished when we get to the final method.</p><p>While the final method is executed in the main thread, the fourth method is being executed in another thread asynchronously.</p><p>So we have learned how we can write asynchronous methods using <a href="https://docs.oracle.com/en/java/javase/18/docs/api/java.base/java/util/concurrent/Executors.html">Executors</a>, <code>Callable</code> and <code>Future</code>.</p><p><a href="https://docs.oracle.com/en/java/javase/18/docs/api/java.base/java/util/concurrent/CompletableFuture.html">CompletableFuture</a> is another way to deal with asynchronicity in Java, and it is considered to be a much better way. This is how the above code can be written:</p><pre><code>private static Credit calculateCreditForPerson(Long personId) throws ExecutionException, InterruptedException {
   return CompletableFuture.supplyAsync(() -&gt; getPerson(personId))
           .thenComposeAsync(person -&gt; {
        final var assetFuture = CompletableFuture.supplyAsync(() -&gt; getAssets(person));
        final var liabilitiesFuture = CompletableFuture.supplyAsync(() -&gt; getLiabilities(person));
        final var importantWork = CompletableFuture.runAsync(Playground::doSomeImportantTask);
       return importantWork.thenCompose((v) -&gt; assetFuture.thenCombineAsync(liabilitiesFuture, ((assets, liabilities) -&gt; calculateCredit(assets, liabilities))));
   }).get();
}
</code></pre><p>But I wouldn’t explain this in this article because it needs some background. Please wait until the next parts come out…</p><p>Until then, cheers!</p><hr /><h3 id="discover-more-from-a-n-m-bazlur-rahman">Discover more from A N M Bazlur Rahman</h3><p>Subscribe to get the latest posts sent to your email.<br /> Type your email… {#subscribe-email}</p><p>Subscribe {#subscribe-submit}</p></main><footer class="site-footer"><div class="footer-content"><p>A comprehensive archive of articles on Java, Software Development, and Technology</p><p>© 2025 A N M Bazlur Rahman. All articles are archived from <a href="https://bazlur.ca">bazlur.ca</a></p><p> <a href="/feed.xml">RSS Feed</a> • <a href="https://twitter.com/bazlur_rahman">Twitter</a> • <a href="https://github.com/rokon12">GitHub</a></p></div></footer><script> // Fade-in animations on scroll document.addEventListener('DOMContentLoaded', function() { const observerOptions = { threshold: 0.1, rootMargin: '0px 0px -100px 0px' }; const observer = new IntersectionObserver(function(entries) { entries.forEach(entry => { if (entry.isIntersecting) { entry.target.classList.add('visible'); observer.unobserve(entry.target); } }); }, observerOptions); // Observe fade-in elements document.querySelectorAll('.fade-in, .fade-in-up, .fade-in-left, .fade-in-right, .stagger-animation').forEach(el => { observer.observe(el); }); // Add fade-in classes to post cards document.querySelectorAll('.post-card').forEach((card, index) => { card.classList.add('fade-in-up'); card.style.transitionDelay = `${index * 0.1}s`; }); // Removed duplicate image observer - handled by image-optimization.js }); </script> <script defer src="/assets/js/terminal.js"></script> <script defer src="/assets/js/image-optimization.js"></script> <script> if ('loading' in HTMLImageElement.prototype) { const images = document.querySelectorAll('img[loading="lazy"]'); images.forEach(img => { img.src = img.dataset.src || img.src; }); } else { // Fallback for browsers that don't support lazy loading const script = document.createElement('script'); script.src = 'https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.3.2/lazysizes.min.js'; document.body.appendChild(script); } </script> <script> document.addEventListener('DOMContentLoaded', function() { // Mobile menu toggle const mobileMenuToggle = document.querySelector('.mobile-menu-toggle'); const siteNav = document.querySelector('.site-nav'); if (mobileMenuToggle) { mobileMenuToggle.addEventListener('click', function() { const isExpanded = this.getAttribute('aria-expanded') === 'true'; this.setAttribute('aria-expanded', !isExpanded); siteNav.classList.toggle('is-active'); document.body.classList.toggle('menu-open'); }); // Close menu when clicking outside document.addEventListener('click', function(e) { if (!e.target.closest('.site-header') && siteNav.classList.contains('is-active')) { mobileMenuToggle.setAttribute('aria-expanded', 'false'); siteNav.classList.remove('is-active'); document.body.classList.remove('menu-open'); } }); } // Initialize theme const savedTheme = localStorage.getItem('theme') || 'dark'; document.documentElement.setAttribute('data-theme', savedTheme); // Global search shortcut document.addEventListener('keydown', function(e) { // Focus search with / if (e.key === '/' && !e.metaKey && !e.ctrlKey) { const searchInput = document.querySelector('.quick-search-input') || document.querySelector('#search-input'); if (searchInput && document.activeElement !== searchInput) { e.preventDefault(); searchInput.focus(); document.body.classList.add('search-focused'); } } // Clear focus on ESC if (e.key === 'Escape') { const searchInput = document.querySelector('.quick-search-input') || document.querySelector('#search-input'); if (searchInput && document.activeElement === searchInput) { searchInput.blur(); searchInput.value = ''; document.body.classList.remove('search-focused'); } } }); }); </script> <button class="back-to-top" id="back-to-top" aria-label="Back to top"> <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="18 15 12 9 6 15"></polyline> </svg> </button> <script> document.addEventListener('DOMContentLoaded', function() { const backToTopButton = document.getElementById('back-to-top'); // Show/hide button based on scroll position function toggleBackToTop() { if (window.scrollY > 300) { backToTopButton.classList.add('visible'); } else { backToTopButton.classList.remove('visible'); } } // Throttle scroll events let isScrolling = false; window.addEventListener('scroll', function() { if (!isScrolling) { window.requestAnimationFrame(function() { toggleBackToTop(); isScrolling = false; }); isScrolling = true; } }); // Smooth scroll to top backToTopButton.addEventListener('click', function() { window.scrollTo({ top: 0, behavior: 'smooth' }); }); // Initial check toggleBackToTop(); }); </script> <script> if ('serviceWorker' in navigator) { window.addEventListener('load', function() { navigator.serviceWorker.register('/sw.js').then(function(registration) { console.log('ServiceWorker registration successful'); }, function(err) { console.log('ServiceWorker registration failed: ', err); }); }); } </script>